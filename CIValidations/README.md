# MaCh3-DUNE CI Validations
## Overview
MaCh3 DUNE uses a very simple CI which simply compares the outputs of a given app. The correct CI outputs are stored in CIValidations/CIOutputs and are simply generated with
```bash
./application list/of/inputs 2>&1 |  grep -v '\[Monitor.cpp\]' | grep -v '\[manager.cpp\]' | tee output_name.txt
```
*Note* the `grep` is important to filter out machine depedendent information.

## Details of CI Inputs
Currently the CI inputs consist of 
1. `CIFitConfig.yaml` : The MaCh3 config used for fitting
2. `CISampleConfig` : Simple sample config
3. `ci_caf_file.root` : A dummy caf file generated by concatenating existing DUNE cafs
3. `CIXsecConfig`: Dummy xsec-config containing a normalisation systematic for each MaCh3 mode

## Details of CI Outputs
1. `EventRatesCI.txt` : Event rates output using `./EvenRates CIFitConfig.yaml`

## Adding an executable to the CI
All CI code is stored in [CIValidations.yaml](../.github/workflows/CIValidations.yml). New exes can be added here
```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - name: Beam Event Rate Validation
            test_exe: bin/EventRates
            test_config: CIValidations/CIInputs/CIFitConfig.yaml
            old_output: CIValidations/CIOutputs/BeamEventRates.txt
            new_output: CIValidations/CIOutputs/BeamEventRates_New.txt
```

By simply adding a new entry to `include` containing
```yaml
- name: Name of CI run
  test_exe: App you want to test
  test_config: MaCh3 config file/list of arguments to run with the app (usually CIValidations/CIInputs/CIFitConfig.yaml)
  old_output: Path to fixed output. This should be stored in CIValidations/CIOutputs
  new_output: Where should the workflow generate the test output
```

In order to generate the old output simply use the technique above of 
```bash
./application list/of/inputs 2>&1 |  grep -v '\[Monitor.cpp\]' | grep -v '\[manager.cpp\]' | tee output_name.txt
```
